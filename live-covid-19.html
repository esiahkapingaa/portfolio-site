<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>COVID-19 WHO-Style Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f5f5f5;
    }
    section {
      max-width: 1200px;
      margin: auto;
      background: white;
      padding: 20px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      border-radius: 8px;
    }
    #map {
      height: 600px;
      width: 100%;
      border-radius: 8px;
    }
    .info-panel {
      margin-top: 20px;
      padding: 15px;
      background: #fafafa;
      border-radius: 8px;
    }
    .info-panel h3 {
      margin-top: 0;
    }
    .legend i {
      width: 14px;
      height: 14px;
      float: left;
      margin-right: 8px;
      opacity: 0.8;
    }
  </style>
</head>
<body>

<section>
  <h2>COVID-19 Cases by Country (WHO Style)</h2>
  <div id="map"></div>

  <div class="info-panel">
    <h3>WHO Region Color Codes</h3>
    <p>This map shows the number of COVID-19 cases reported by country, using WHO regional colors:</p>
    <ul>
      <li><i style="background:#7b4bc2"></i> Africa</li>
      <li><i style="background:#ff7f0e"></i> Americas</li>
      <li><i style="background:#d62728"></i> Eastern Mediterranean</li>
      <li><i style="background:#1f77b4"></i> Europe</li>
      <li><i style="background:#2ca02c"></i> South-East Asia</li>
      <li><i style="background:#bcbd22"></i> Western Pacific</li>
    </ul>
  </div>
</section>

<script>
const map = L.map('map').setView([20, 0], 2);

L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
  attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors &copy; <a href="https://www.carto.com/">CARTO</a>',
  subdomains: 'abcd',
  maxZoom: 19
}).addTo(map);

const regionColors = {
  "Africa": "#7b4bc2",
  "Americas": "#ff7f0e",
  "Eastern Mediterranean": "#d62728",
  "Europe": "#1f77b4",
  "South-East Asia": "#2ca02c",
  "Western Pacific": "#bcbd22",
  "Other": "#999"
};

// Example mapping (can be expanded)
const countryRegionMap = {
  "Thailand": "South-East Asia",
  "Brazil": "Americas",
  "United States": "Americas",
  "India": "South-East Asia",
  "South Africa": "Africa",
  "France": "Europe",
  "Egypt": "Eastern Mediterranean",
  "China": "Western Pacific"
};

fetch("https://disease.sh/v3/covid-19/countries")
  .then(res => res.json())
  .then(data => {
    data.forEach(country => {
      const region = countryRegionMap[country.country] || "Other";
      const color = regionColors[region];
      
      // Smaller circle radius
      const radius = Math.sqrt(country.cases) / 200; 

      const circle = L.circleMarker(
        [country.countryInfo.lat, country.countryInfo.long],
        {
          radius: radius,
          fillColor: color,
          color: "#555",
          weight: 1,
          opacity: 1,
          fillOpacity: 0.7
        }
      ).addTo(map);

      // Show popup on hover
      circle.bindPopup(
        `<b>${country.country}</b><br>Cases: ${country.cases.toLocaleString()}<br>Region: ${region}`
      );

      circle.on("mouseover", function(e) {
        this.openPopup();
      });
      circle.on("mouseout", function(e) {
        this.closePopup();
      });
    });
  });
</script>
</body>
</html>
