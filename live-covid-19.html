<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>COVID-19 WHO-Style Map - Live Covid-19 data</title>
  
  <!-- SEO Meta -->
<meta name="description" content="Interactive COVID-19 dashboard using Python and WHO data. Explore global trends and insights through visual data storytelling." />
<meta name="keywords" content="COVID-19 dashboard, Up to date covid-19 data, Covid-19 Cases today, data visualization, global health, Python, WHO data, Esiah Kapinga, analytics" />
<meta name="author" content="Esiah Kapinga" />
<meta name="robots" content="index, follow" />
<meta name="theme-color" content="#facc15" />
<link rel="canonical" href="https://esiiah.github.io/portfolio-site/live-covid-19.html" />

<!-- Favicon -->
<link rel="icon" type="image/png" href="images/esiah-logo.png" />

<!-- Open Graph & Twitter -->
<meta property="og:title" content="COVID-19 Up-To-Date Data — Esiah Kapinga" />
<meta property="og:description" content="Track global COVID-19 trends using WHO data using disease-sh APIs and Python and HTTPS. Visualized for clarity and insight." />
<meta property="og:image" content="images/your-project-banner.png" />
<meta property="og:url" content="https://esiiah.github.io/portfolio-site/covid-dashboard.html" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="COVID-19 Global Dashboard — Esiah Kapinga" />
<meta name="twitter:description" content="Data visualization of COVID-19 trends worldwide using Python,HTTPS, and WHO data through disease-sh API." />
<meta name="twitter:image" content="images/your-project-banner.png" />

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Poppins:wght@600;700&display=swap" rel="stylesheet">

<!-- Leaflet + Chart.js -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  
<style>
/* Root & Fonts */
body {
  font-family: 'Inter', Arial, sans-serif;
  background: #fff;
  color: #1f2937; /* similar to Tailwind gray-800 */
  margin: 0;
  padding: 0;
  line-height: 1.6;
}

/* Reset for header area */
header {
  background-color: white;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  padding: 1rem;
  position: sticky;
  top: 0;
  z-index: 50;
}

header .container {
  max-width: 96rem; /* similar to max-w-6xl */
  margin: 0 auto;
  display: flex;
  align-items: center;
  justify-content: space-between;
  overflow-x: auto;
}

header .logo {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex-shrink: 0;
  text-decoration: none;
  color: black;
}

header .logo img {
  height: 2rem;
  width: auto;
}

header .logo h1 {
  font-size: 1.25rem;
  font-weight: 600;
  letter-spacing: 0.05em;
}

header nav {
  display: flex;
  gap: 0.75rem;
  overflow-x: auto;
  margin-left: 1rem;
  scrollbar-width: none; /* Firefox */
}

header nav::-webkit-scrollbar {
  display: none; /* Chrome/Safari */
}

header nav a {
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
  font-weight: 600;
  text-decoration: none;
  border-radius: 0.5rem;
  white-space: nowrap;
  transition: background-color 0.2s ease;
}

header .btn-yellow-light {
  background-color: #fef9c3;
  color: #ca8a04;
  border: 1px solid #facc15;
}
header .btn-yellow-light:hover {
  background-color: #fef08a;
}

header .btn-yellow-solid {
  background-color: #eab308;
  color: white;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}
header .btn-yellow-solid:hover {
  background-color: #ca8a04;
}


/* ---------- Hero Section Styles ---------- */

/* Common Hero Text */
.hero-text {
    position: absolute;
    top: 0;
    left: 0;
    color: white;
    padding: 1rem;
    border-radius: 0.75rem;
    background: linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(0,0,0,0));
}

/* Hero Text Typography */
.hero-text h1 {
    font-family: 'Poppins', sans-serif;
    font-weight: 700;
    margin-bottom: 0.25rem;
}
.hero-text h2 {
    font-family: 'Poppins', sans-serif;
    font-weight: 700;
    color: #FBBF24;
    margin-bottom: 0.5rem;
}
.hero-text p {
    font-size: 0.875rem;
}

/* ---------- Desktop Hero ---------- */
#hero-desktop {
    width: 100%;
    padding: 0.5rem 0;
    position: relative;
    border-radius: 3rem;
    overflow: hidden;
}

#hero-desktop img {
    width: 100%;
    height: auto;
    display: block;
    border-radius: 3rem;
}

/* Gradient overlay behind text (optional extra layer) */
#hero-desktop::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(0,0,0,0));
    border-radius: 3rem;
    z-index: 1;
}

/* ---------- Mobile Hero ---------- */
#hero-mobile {
    width: 100%;
    padding: 1.5rem 1rem;
    position: relative;
    border-radius: 1.5rem;
    overflow: hidden;
}

#hero-mobile img {
    width: 100%;
    height: auto;
    display: block;
    border-radius: 1.5rem;
}

/* ---------- Visibility Control ---------- */
.desktop-banner {
    display: none;
}

.mobile-banner {
    display: block;
}

/* Show desktop only on screens >=768px, hide mobile */
@media screen and (min-width: 768px) {
    .desktop-banner {
        display: block;
    }
    .mobile-banner {
        display: none;
    }
}


/* Main Content */
main {
    padding: 2rem 4rem;
    max-width: 1200px;
    margin: auto;
}


body {
  font-family: 'Inter', Arial, sans-serif;
  background: #fff;
  color: #1f2937; /* similar to Tailwind gray-800 */
  margin: 0;
  padding: 0;
  line-height: 1.6;
}

.section {
  margin-bottom: 2rem; /* similar to mb-8 */
}

.section-title {
  font-size: 1.5rem; /* ~text-2xl */
  font-weight: 600;  /* font-semibold */
  margin-bottom: 1rem; /* ~mb-4 */
}

.section-text {
  font-size: 1.125rem; /* ~text-lg */
  color: #1f2937; 
  line-height: 1.75; /* leading-relaxed */
}

.section-list {
  list-style-type: disc;
  padding-left: 1.5rem; /* like list-inside */
  font-size: 1.125rem;
  color: #1f2937;
}

.section-list li {
  margin-bottom: 0.5rem; /* similar to space-y-2 */
}


/* Tables */
table { border-collapse: collapse; width: 100%; }
th, td { padding: 0.5rem; border: 1px solid #D1D5DB; text-align: left; }
thead { background: #F3F4F6; }

/* Footer */
footer {
    text-align: center;
    color: #6B7280;
    padding: 2rem 1rem;
    border-top: 1px solid #374151;
}
footer a { color: #2563EB; text-decoration: underline; }
footer .social-icons { display: flex; justify-content: center; gap: 1rem; margin-top: 1rem; }
footer .social-icons img { width: 1.5rem; height: 1.5rem; }


:root{
  --bg:#ffffff;
  --panel:#fafafa;
  --text:#111;
  --muted:#666;
  --border:#e7e7e7;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
h2{margin:0 0 10px}
section{padding:16px}

.map-container{
  display:grid;
  grid-template-columns: 2fr 1fr;
  gap:14px;
  align-items:start;
}
.map-box{
  position:relative;
  background:#fff;
  border:1px solid var(--border);
  border-radius:10px;
  overflow:hidden;
  min-height:120px;
}
#global-map{height:520px;}
/* India map = half of global vertically */
#india-map{height:260px;}

#global-map-loader,
#india-map-loader{
  position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
  font-weight:600;font-size:14px;
  background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.85));
  z-index:10
}

.india-stats{
  padding:12px 14px;
  background:var(--panel);
  border-top:1px solid var(--border);
}

.info-panel{
  margin-top: 12px;
  padding: 12px 14px;
  background: var(--panel);
  border-radius: 10px;
  border:1px solid var(--border);
}

select{
  padding:6px 8px;border-radius:8px;border:1px solid var(--border);
  font-size:14px;background:#fff;color:var(--text)
}

.legend{list-style:none;padding:0;margin:8px 0 0}
.legend li{display:flex;align-items:center;gap:8px;margin:4px 0}
.legend i{width:14px;height:14px;border-radius:3px;display:inline-block;border:1px solid #ddd}

.country-stats{
  margin-top: 16px; padding: 14px; background: #f9f9f9; border-radius: 10px; border:1px solid var(--border)
}

/* Responsive */
@media (max-width: 980px){
  .map-container{grid-template-columns: 1fr}
  #global-map{height:420px}
  #india-map{height:240px}
}

/* Animations */
@keyframes spin-slow { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);} }
@keyframes fadeInOut { 0%,100%{opacity:0;} 50%{opacity:1;} }
@keyframes slide { 0% {transform: translateX(0);} 20% {transform: translateX(-100%);} 40% {transform: translateX(-200%);} 60% {transform: translateX(-300%);} 80% {transform: translateX(-400%);} 100% {transform: translateX(-500%);} }

/* Responsive */
@media (min-width: 768px) {
    #hero-desktop { display: block; }
    #hero-mobile { display: none; }
}

/* Mobile adjustments */
@media (max-width: 767px) {
    main {
        padding: 1rem;  /* smaller padding on phone */
    }
    section {
        padding: 15px;  /* reduce section padding for better fit */
    }
    section h2 {
        font-size: 1.25rem; /* smaller heading */
    }
    section ul li, section ol li {
        font-size: 0.9rem; /* smaller list items */
    }
    .hero-text h1 {
        font-size: 1rem;
    }
    .hero-text h2 {
        font-size: 0.875rem;
    }
    .hero-text p {
        font-size: 0.75rem;
    }
    #map {
        height: 400px; /* smaller map for mobile */
    }
}
</style>
</head>

<body style="margin:0; padding:0; background-color:white; font-family:sans-serif; color:black;">
<header>
  <div class="container">
    <!-- Logo and Name -->
    <a href="index.html" class="logo">
      <img src="images/esiah-logo.png" alt="Esiah Logo" />
      <h1>Esiah</h1>
    </a>

    <!-- Navigation -->
    <nav>
      <a href="index.html#home" class="btn-yellow-light">Home</a>
      <a href="index.html#projects" class="btn-yellow-solid">Projects</a>
      <a href="Esiah-Kapinga-Resume.pdf" download class="btn-yellow-light">Resume</a>
      <a href="index.html#contact" class="btn-yellow-light">Contact</a>
    </nav>
  </div>
</header>

<!-- Desktop COVID Banner -->
<section class="desktop-banner" style="width: 100%; background: #fff; padding: 0.5rem 2rem;">
    <div style="position: relative; border-radius: 3rem; overflow: hidden; max-width: 2069.856px; margin: 0 auto;">
        <img src="images/covid-banner.png"
             alt="COVID Analysis Banner"
             style="width: 100%; height: 500px; object-fit: cover; display: block;" />

        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: flex-start; padding: 2rem;">
            <div style="background: linear-gradient(to bottom, rgba(0,0,0,0.7), rgba(0,0,0,0)); padding: 1.5rem; max-width: 600px; color: white;">
                <h1 style="font-family: 'Poppins', sans-serif; font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">
                    COVID-19 Data Insights
                </h1>
                <h2 style="font-family: 'Poppins', sans-serif; font-size: 1.75rem; font-weight: 700; color: #FBBF24; margin-bottom: 0.5rem; text-shadow: 0 1px 3px rgba(0,0,0,0.5);">
                    Regional & Global Trends
                </h2>
                <p style="font-size: 1rem; text-shadow: 0 1px 2px rgba(0,0,0,0.5);">
                    Analysis of COVID-19 cases, vaccinations, and mortality rates across regions.
                </p>
            </div>
        </div>
    </div>
</section>

<!-- Mobile COVID Banner -->
<section class="mobile-banner" style="width: 100%; background: #fff; padding: 1.5rem 1rem;">
    <div style="position: relative; border-radius: 1.5rem; overflow: hidden;">
        <img src="images/covid-mb-banner.png"
             alt="COVID Analysis Banner"
             style="width: 100%; height: auto; object-fit: cover; border-radius: 1.5rem; display: block;" />

        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: flex-start; justify-content: flex-start; padding: 1rem;">
            <div style="background: linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(0,0,0,0)); padding: 1rem; border-radius: 0.75rem; max-width: 90%;">
                <h1 style="font-family: 'Poppins', sans-serif; font-size: 1.25rem; font-weight: 700; margin-bottom: 0.25rem; color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.5);">
                    COVID-19 Data Insights
                </h1>
                <h2 style="font-family: 'Poppins', sans-serif; font-size: 1rem; font-weight: 700; color: #FBBF24; margin-bottom: 0.5rem; text-shadow: 0 1px 2px rgba(0,0,0,0.5);">
                    Regional & Global Trends
                </h2>
                <p style="font-size: 0.875rem; color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.5);">
                    Analysis of COVID-19 cases, vaccinations, and mortality rates across regions.
                </p>
            </div>
        </div>
    </div>
</section>

  
<!-- Main Content -->
<main style="padding: 1rem 4%; max-width: 100%;">
<!-- Overview -->
<section>
     <h2>Overview</h2>
     <p>This project leverages real-time COVID-19 data fetched from the <a href="https://disease.sh" target="_blank">disease.sh API</a> to visualize global trends, including infection rates, recovery trajectories, and geographical impact. Using JavaScript, Leaflet.js, and GeoJSON, the project builds an interactive dashboard and live maps, providing up-to-date epidemiological insights.</p>

     <!-- Objectives -->
     <h2>Objectives</h2>
        <ul>
          <li>Fetch real-time COVID-19 data globally via the disease.sh API</li>
          <li>Build an interactive world map showing live infection hotspots and recovery distribution</li>
          <li>Plot live daily trends for confirmed cases, deaths, and recoveries by country/region</li>
          <li>Enable user filtering by date range and country to see dynamic data changes</li>
          <li>Provide insights into pandemic progression and regional differences using live data</li>
         </ul>
</section>

<section>
  <h2>COVID-19 Cases by Country (WHO Style)</h2>

  <label for="range">Select Time Range:&nbsp;</label>
  <select id="range" aria-label="Global map range">
    <option value="7">Last 7 Days</option>
    <option value="30">Last 30 Days</option>
    <option value="365">Last 365 Days</option>
    <option value="all">All Time</option>
  </select>

  <div class="map-container" style="margin-top:10px;">
    <!-- GLOBAL -->
    <div class="map-box">
      <div id="global-map-loader">Loading global map…</div>
      <div id="global-map" role="region" aria-label="Global COVID-19 map"></div>
    </div>

    <!-- INDIA -->
    <div class="map-box">
      <div id="india-map-loader">Loading India map…</div>
      <div id="india-map" role="region" aria-label="India COVID-19 map"></div>
      <div class="india-stats">
        <h3 style="margin:0 0 6px;">India COVID‑19 (WHO)</h3>
        <div style="font-size:14px;color:var(--muted);margin-bottom:6px;">Updated weekly from WHO global table</div>
        <p style="margin:.3rem 0;"><strong>Total Cases:</strong> <span id="india-total">—</span></p>
        <p style="margin:.3rem 0;"><strong>New (last 7 days):</strong> <span id="india-new7">—</span></p>
        <p style="margin:.3rem 0;"><strong>Total Deaths:</strong> <span id="india-deaths">—</span></p>
        <p style="margin:.3rem 0;"><strong>New Deaths (7 days):</strong> <span id="india-newDeaths7">—</span></p>
      </div>
    </div>
  </div>

  <div class="info-panel">
    <h3 style="margin:0 0 8px;">WHO Region Color Codes</h3>
    <p style="margin:0 0 8px;">The global map uses WHO‑style region colors (mapped from continent data; India is assigned to South‑East Asia).</p>
    <ul class="legend">
      <li><i style="background:#7b4bc2"></i> Africa</li>
      <li><i style="background:#ff7f0e"></i> Americas</li>
      <li><i style="background:#1f77b4"></i> Europe</li>
      <li><i style="background:#2ca02c"></i> South‑East Asia</li>
      <li><i style="background:#bcbd22"></i> Western Pacific</li>
      <li><i style="background:#d62728"></i> Eastern Mediterranean</li>
      <li><i style="background:#999"></i> Other/Unknown</li>
    </ul>
  </div>

  <!-- Country Search & Stats -->
  <div class="country-stats">
    <h3 style="margin:0 0 10px;">Search Country Data</h3>

    <label for="countrySelect">Select Country:&nbsp;</label>
    <select id="countrySelect" aria-label="Country chooser">
      <option value="">— Choose a Country —</option>
    </select>

    <label for="countryRange" style="margin-left:10px;">Select Time Range:&nbsp;</label>
    <select id="countryRange" aria-label="Country range">
      <option value="7">Last 7 Days</option>
      <option value="30">Last 30 Days</option>
      <option value="365">Last 365 Days</option>
      <option value="all">All Time</option>
    </select>

    <div id="countryInfo" style="margin-top: 12px; font-size: 0.95rem; color: #111;">
      <p style="margin:.3rem 0;"><strong>Cases:</strong> <span id="casesCount">—</span></p>
      <p style="margin:.3rem 0;"><strong>Deaths:</strong> <span id="deathsCount">—</span></p>
      <p style="margin:.3rem 0;"><strong>Recovered:</strong> <span id="recoveredCount">—</span></p>
    </div>
  </div>
</section>

<!-- Trend Charts -->
<section id="trend-section" style="margin-top: 10px;">
  <h2>COVID‑19 Trends</h2>
  <p style="margin:0 0 10px;">A flat placeholder line is shown until a country is selected.</p>
  <div style="display:flex;flex-wrap:wrap;gap:20px;">
    <div style="flex:1;min-width:320px;">
      <canvas id="casesChart"></canvas>
    </div>
    <div style="flex:1;min-width:320px;">
      <canvas id="deathsChart"></canvas>
    </div>
  </div>
</section>

<!-- Sources -->
<section>
  <h2>Data Sources</h2>
  <table style="width:100%;border-collapse:collapse;border:1px solid #eee">
    <thead>
      <tr><th style="text-align:left;padding:8px;border-bottom:1px solid #eee;">Source</th><th style="text-align:left;padding:8px;border-bottom:1px solid #eee;">Description</th></tr>
    </thead>
    <tbody>
      <tr><td style="padding:8px;border-bottom:1px solid #eee;">WHO Global Table CSV</td><td style="padding:8px;border-bottom:1px solid #eee;">Official weekly data used for India</td></tr>
      <tr><td style="padding:8px;border-bottom:1px solid #eee;">disease.sh</td><td style="padding:8px;border-bottom:1px solid #eee;">Global country data & historical time series</td></tr>
    </tbody>
  </table>
  <p style="margin-top:.5rem;font-size:.875rem;font-style:italic;">
    WHO CSV: <a href="https://covid19.who.int/WHO-COVID-19-global-table-data.csv" target="_blank" rel="noopener">https://covid19.who.int/WHO-COVID-19-global-table-data.csv</a>
  </p>
  
    <!-- Methods & Tools -->
        <h2>Methods & Tools</h2>
        <ol>
            <li><strong>Data Retrieval</strong>: Accessed WHO or COVID19 API, parsed JSON into Pandas, cleaned missing/inconsistent values.</li>
            <li><strong>Data Wrangling</strong>: Aggregated case data, calculated rates, merged with GeoJSON country coordinates.</li>
            <li><strong>Mapping (Folium)</strong>: Built choropleth maps and circle marker layers with popups.</li>
            <li><strong>Visualization (Plotly)</strong>: Created interactive time series plots, bar charts, and optional animations.</li>
        </ol>

    <!-- Example Insights -->
        <h2>Example Insights</h2>
        <ul>
            <li>India, USA, and Brazil exhibited consistent surges aligned with policy delays.</li>
            <li>Recovery rates rose significantly post-July 2021 with mass vaccination campaigns.</li>
            <li>African nations showed underreporting patterns — visualized as data sparsity.</li>
            <li>Reinfection waves (Delta, Omicron) visualized in animated strain-period plots.</li>
        </ul>

      <!-- Tools Used for Interactive Live Data Map -->
        <h2>Tools Used for Interactive Live Data Map</h2>
        <table>
            <thead>
                <tr><th>Tool</th><th>Purpose</th></tr>
            </thead>
            <tbody>
                <tr><td>JavaScript</td><td>Fetch live API data and build interactive visualizations</td></tr>
                <tr><td>Leaflet.js</td><td>Interactive maps with markers, popups, and layers</td></tr>
                <tr><td>disease.sh API</td><td>Real-time global COVID-19 data</td></tr>
                <tr><td>GeoJSON</td><td>Country coordinates and shapes for mapping</td></tr>
                <tr><td>HTML & CSS</td><td>Page structure, styling, and responsive layout</td></tr>
                <tr><td>Optional Libraries (Chart.js / Plotly)</td><td>Interactive charts linked with map data</td></tr>
            </tbody>
        </table>

    <!-- Tools We can use for Static Map-->
        <h2>Tools We can use for Static Map</h2>
        <table>
            <thead>
                <tr><th>Tool</th><th>Purpose</th></tr>
            </thead>
            <tbody>
                <tr><td>Python</td><td>Data processing and visualization</td></tr>
                <tr><td>Pandas</td><td>Data cleaning and manipulation</td></tr>
                <tr><td>Plotly</td><td>Interactive graphs and plots</td></tr>
                <tr><td>Folium</td><td>Geospatial mapping</td></tr>
                <tr><td>GeoJSON</td><td>Geolocation mapping</td></tr>
                <tr><td>Jupyter Notebook</td><td>Interactive development</td></tr>
            </tbody>
        </table>

    <!-- Applications -->
        <h2>Applications</h2>
        <ul>
            <li>Public health communication to display global pandemic impact</li>
            <li>Support for policy decision-making and resource allocation</li>
            <li>Educational tool for understanding epidemiological data</li>
            <li>Research support in real-time COVID surveillance and modeling</li>
        </ul>
</section>
</main>
  
<!-- Footer -->
<footer>
    <p>All visualizations and maps are interactive. Data is updated regularly. Ethical considerations were applied regarding reporting accuracy and transparency.</p>
    <div class="social-icons">
        <a href="https://www.linkedin.com/in/esiah-kapinga" target="_blank"><img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/linkedin/linkedin-original.svg" alt="LinkedIn"></a>
        <a href="https://github.com/esiiah" target="_blank"><img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/github/github-original.svg" alt="GitHub"></a>
        <a href="https://www.instagram.com/esiah_kapinga" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" alt="Instagram"></a>
        <a href="https://youtube.com/esiah.1" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/1384/1384060.png" alt="YouTube"></a>
    </div>
    <p style="margin-top:0.5rem;">&copy; 2025 Esiah Kapinga - COVID-19 Live Data Project</p>
</footer>
<script>
/* ==============================
   UTIL & CONSTANTS
============================= */
const regionColors = {
  "Africa": "#7b4bc2",
  "Americas": "#ff7f0e",
  "Eastern Mediterranean": "#d62728",
  "Europe": "#1f77b4",
  "South-East Asia": "#2ca02c",
  "Western Pacific": "#bcbd22",
  "Other": "#999"
};

function mapContinentToWHO(continent, countryName) {
  if (countryName === "India") return "South-East Asia";
  if (["China","Japan","Australia","New Zealand"].includes(countryName) || continent === "Australia/Oceania") return "Western Pacific";
  if (["North America","South America"].includes(continent)) return "Americas";
  if (continent === "Europe") return "Europe";
  if (continent === "Asia") return "South-East Asia";
  if (continent === "Africa") return "Africa";
  return "Other";
}

const fmt = n => (n == null ? "—" : Number(n).toLocaleString());


/* ==============================
   MAPS SETUP
============================= */
// Global map
const globalMap = L.map('global-map', {
  worldCopyJump: true, zoomSnap: 0.25, zoomDelta: 0.25
}).setView([20, 0], 2);
globalMap.setMinZoom(2); globalMap.setMaxZoom(6);
L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
  attribution: '&copy; OpenStreetMap contributors &copy; CARTO',
  subdomains: 'abcd', maxZoom: 19
}).addTo(globalMap);

// India map
const indiaMap = L.map('india-map', { worldCopyJump: false }).setView([22.9734, 78.6569], 4);
L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
  attribution: '&copy; OpenStreetMap contributors &copy; CARTO',
  subdomains: 'abcd', maxZoom: 19
}).addTo(indiaMap);

let globalMarkers = [];
let globalCache = null;
let indiaMarker = null;

async function fetchCountryData(country, startDate, endDate) {
    const url = `https://disease.sh/v3/covid-19/historical/${country}?lastdays=all`;
    const res = await fetch(url);
    const data = await res.json();

    if (!data.timeline) {
        console.warn(`No timeline data for ${country}`);
        return { cases: 0, deaths: 0 };
    }

    const timeline = Object.keys(data.timeline.cases).map(date => ({
        date,
        cases: data.timeline.cases[date],
        deaths: data.timeline.deaths[date]
    }));

    return calculateStats(timeline, startDate, endDate);
}

function calculateStats(timeline, startDate, endDate) {
    const startIdx = timeline.findIndex(d => d.date === startDate);
    const endIdx = timeline.findIndex(d => d.date === endDate);

    if (startIdx === -1 || endIdx === -1) {
        return { cases: 0, deaths: 0 };
    }

    //  Correct calculations (differences, not sums)
    const cases = timeline[endIdx].cases - timeline[startIdx].cases;
    const deaths = timeline[endIdx].deaths - timeline[startIdx].deaths;

    return { cases, deaths };
}

// Loop through countries one at a time
async function updateStats(countries, startDate, endDate) {
    let totalCases = 0;
    let totalDeaths = 0;

    for (const country of countries) {
        const { cases, deaths } = await fetchCountryData(country, startDate, endDate);
        totalCases += cases;
        totalDeaths += deaths;
    }

    console.log(`From ${startDate} to ${endDate}:`);
    console.log(`Total Cases: ${totalCases}`);
    console.log(`Total Deaths: ${totalDeaths}`);
}

async function loadGlobalData(days = 'all') {
  document.getElementById("global-map-loader").style.display = "flex";
  globalMarkers.forEach(m => globalMap.removeLayer(m));
  globalMarkers = [];

  try {
    if (!globalCache) {
      const res = await fetch("https://disease.sh/v3/covid-19/countries?allowNull=false");
      globalCache = await res.json();
    }
    const countries = globalCache;
    const maxCases = Math.max(...countries.map(c => c.cases || 0), 1);
    const maxRadius = 36;

    for (const c of countries) {
      const casesDisplay = (days === 'all')
        ? c.cases
        : await fetchCountryRange(c.country, days);

      const region = mapContinentToWHO(c.continent, c.country);
      const color = regionColors[region] || regionColors["Other"];
      const radius = Math.sqrt((casesDisplay || 0) / maxCases) * maxRadius;

      const circle = L.circleMarker([c.countryInfo.lat, c.countryInfo.long], {
        radius: Math.max(2, radius),
        fillColor: color, color: "#555", weight: 0.6, fillOpacity: 0.75
      }).addTo(globalMap);

      circle.bindPopup(`
        <b>${c.country}</b><br>
        Cases (${days==='all'?'total':'last '+days+'d'}): ${fmt(casesDisplay)}<br>
        Deaths: ${fmt(c.deaths)}<br>
        Region: ${region}
      `);

      circle.on('mouseover', () => circle.openPopup());
      circle.on('click', () => circle.openPopup());

      globalMarkers.push(circle);
    }
  } catch(err) {
    console.error("Error loading global:", err);
  } finally {
    document.getElementById("global-map-loader").style.display = "none";
  }
}


/* ==============================
   INDIA DATA VIA WHO CSV
============================= */
async function loadIndiaData() {
  document.getElementById("india-map-loader").style.display = "flex";
  if (indiaMarker) indiaMap.removeLayer(indiaMarker);

async function fetchCountryData(country, startDate, endDate) {
    const url = `https://disease.sh/v3/covid-19/historical/${country}?lastdays=all`;
    const res = await fetch(url);
    const data = await res.json();

    let indiaRow = null;
    for (const row of rows.slice(1)) {
      if (!row) continue;
      const cols = parseCSVRow(row);
      if ((cols[idxName]||"").toLowerCase() === "india") {
        indiaRow = cols;
        break;
      }
    }

    const new7 = indiaRow ? Number((indiaRow[idxNew7]||"").replace(/[^0-9]/g,'')) : null;
    const region = "South-East Asia";
    const color = regionColors[region];

    indiaMarker = L.marker([22.9734, 78.6569], {
      icon: L.icon({
        iconUrl: 'https://cdn-icons-png.flaticon.com/512/2705/2705262.png',
        iconSize: [32,32], iconAnchor: [16,32]
      })
    }).addTo(indiaMap);

    indiaMarker.bindPopup(`
      <b>India</b><br>
      Cases (last 7 days): ${fmt(new7)}
    `).openPopup();

    document.getElementById("india-new7").textContent = fmt(new7);
  } catch(err) {
    console.error("Error loading India WHO data:", err);
  } finally {
    document.getElementById("india-map-loader").style.display = "none";
  }
}

function parseCSVRow(line) {
  const out = []; let cur = "", inQ = false;
  for (let i = 0; i < line.length; i++) {
    const ch = line[i];
    if (ch === '"') {
      if (inQ && line[i+1] === '"') { cur += '"'; i++; }
      else inQ = !inQ;
    } else if (ch === ',' && !inQ) {
      out.push(cur); cur = "";
    } else cur += ch;
  }
  out.push(cur);
  return out;
}

/* ==============================
   USAGE
============================= */
loadGlobalData(7);   // loads global map with last 7 days data
loadIndiaData();     // loads India marker with WHO weekly cases



/* ==============================
   COUNTRY DROPDOWN
============================== */
const countrySelect = document.getElementById('countrySelect');
async function loadCountryOptions(){
  try{
    if(!globalCache){
      const res = await fetch('https://disease.sh/v3/covid-19/countries?allowNull=false');
      globalCache = await res.json();
    }
    const list = [...globalCache].sort((a,b)=>a.country.localeCompare(b.country));
    const frag = document.createDocumentFragment();
    for(const c of list){
      const opt = document.createElement('option');
      opt.value = c.country;
      opt.textContent = c.country;
      frag.appendChild(opt);
    }
    countrySelect.appendChild(frag);
  }catch(e){ console.error(e); }
}

/* ==============================
   COUNTRY STATS (disease.sh)
============================== */
async function loadCountryData(country, days){
  if(!country) return;
  // use historical endpoint (cached)
  const key = country + "::" + (days==='all'?'all':String(days));
  let data = historyCache.get(key);
  if(!data){
    const res = await fetch(`https://disease.sh/v3/covid-19/historical/${encodeURIComponent(country)}?lastdays=${days==='all'? 1000 : days}`);
    data = await res.json();
    historyCache.set(key, data);
  }
  if(!data.timeline) return;

  const casesTL = Object.values(data.timeline.cases);
  const deathsTL = Object.values(data.timeline.deaths);
  const recTL    = Object.values(data.timeline.recovered);

  const last = (arr)=>arr[arr.length-1] ?? 0;
  const delta = (arr)=> (arr.length>1 ? (arr[arr.length-1] - arr[0]) : last(arr));

  const casesCount    = (days==='all') ? last(casesTL) : delta(casesTL);
  const deathsCount   = (days==='all') ? last(deathsTL) : delta(deathsTL);
  const recoveredCount= (days==='all') ? last(recTL)    : delta(recTL);

  document.getElementById('casesCount').textContent = fmt(casesCount);
  document.getElementById('deathsCount').textContent = fmt(deathsCount);
  document.getElementById('recoveredCount').textContent = fmt(recoveredCount);
}

/* ==============================
   TREND CHARTS
============================== */
let casesChartInstance, deathsChartInstance;

function ensureChart(ctx, label){
  return new Chart(ctx, {
    type:'line',
    data:{ labels:[], datasets:[{
      label, data:[], borderWidth:2, fill:true, tension:.3, pointRadius:0,
      borderColor: label==='Cases' ? '#007bff' : '#ff0000',
      backgroundColor: (label==='Cases' ? '#007bff' : '#ff0000') + '33'
    }]},
    options:{
      responsive:true,
      plugins:{ legend:{display:true}},
      scales:{ x:{display:true}, y:{display:true}}
    }
  });
}
function setFlatPlaceholder(chart){
  const labels = Array.from({length:30}, (_,i)=> String(i+1));
  const data = Array.from({length:30}, ()=> 0);
  chart.data.labels = labels;
  chart.data.datasets[0].data = data;
  chart.update();
}
async function updateTrendCharts(country, days){
  if(!country){ setFlatPlaceholder(casesChartInstance); setFlatPlaceholder(deathsChartInstance); return; }
  const res = await fetch(`https://disease.sh/v3/covid-19/historical/${encodeURIComponent(country)}?lastdays=${days==='all'? 1000 : days}`);
  const data = await res.json();
  if(!data.timeline) return;
  const labels = Object.keys(data.timeline.cases);
  const casesData = Object.values(data.timeline.cases);
  const deathsData = Object.values(data.timeline.deaths);

  casesChartInstance.data.labels = labels;
  casesChartInstance.data.datasets[0].data = casesData;
  casesChartInstance.update();

  deathsChartInstance.data.labels = labels;
  deathsChartInstance.data.datasets[0].data = deathsData;
  deathsChartInstance.update();
}

/* ==============================
   INIT
============================== */
(async function init(){
  // Create charts first with flat trend
  casesChartInstance  = ensureChart(document.getElementById('casesChart').getContext('2d'), 'Cases');
  deathsChartInstance = ensureChart(document.getElementById('deathsChart').getContext('2d'), 'Deaths');
  setFlatPlaceholder(casesChartInstance);
  setFlatPlaceholder(deathsChartInstance);

  await Promise.all([loadGlobalData('7'), loadIndiaData(), loadCountryOptions()]);
})();

/* ==============================
   UI EVENTS (debounced)
============================== */
const debounce = (fn, ms=200)=>{ let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), ms); }; };

document.getElementById("range").addEventListener("change", e=>{
  // We keep bubble sizes based on total for speed; still reload to re-render if desired
  debounce(()=>loadGlobalData(e.target.value), 50)();
});

countrySelect.addEventListener('change', debounce(()=>{
  const country = countrySelect.value;
  const days = document.getElementById('countryRange').value;
  if(country){
    loadCountryData(country, days);
    updateTrendCharts(country, days);
  }else{
    document.getElementById('casesCount').textContent = '—';
    document.getElementById('deathsCount').textContent = '—';
    document.getElementById('recoveredCount').textContent = '—';
    setFlatPlaceholder(casesChartInstance);
    setFlatPlaceholder(deathsChartInstance);
  }
}, 100));

document.getElementById('countryRange').addEventListener('change', debounce(()=>{
  const country = countrySelect.value;
  const days = document.getElementById('countryRange').value;
  if(country){
    loadCountryData(country, days);
    updateTrendCharts(country, days);
  }
}, 100));
</script>
</body>
</html>
