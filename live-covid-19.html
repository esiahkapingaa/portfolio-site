<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>COVID-19 WHO-Style Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    #map { height: 600px; width: 100%; }
    .legend { 
      background: white; 
      padding: 10px; 
      font-size: 14px; 
      line-height: 18px; 
      color: #555;
    }
    .legend i {
      width: 18px;
      height: 18px;
      float: left;
      margin-right: 8px;
      opacity: 0.8;
    }
  </style>
</head>
<body>
<h2>COVID-19 Cases by Country (WHO Style)</h2>
<div id="map"></div>

<script>
const map = L.map('map').setView([20, 0], 2);

L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
  attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors &copy; <a href="https://www.carto.com/">CARTO</a>',
  subdomains: 'abcd',
  maxZoom: 19
}).addTo(map);

// WHO region colors
const regionColors = {
  "Africa": "#7b4bc2",
  "Americas": "#ff7f0e",
  "Eastern Mediterranean": "#d62728",
  "Europe": "#1f77b4",
  "South-East Asia": "#2ca02c",
  "Western Pacific": "#bcbd22",
  "Other": "#999"
};

// Map countries to WHO regions (example subset)
const countryRegionMap = {
  "Thailand": "South-East Asia",
  "Brazil": "Americas",
  "United States": "Americas",
  "India": "South-East Asia",
  "South Africa": "Africa",
  "France": "Europe",
  "Egypt": "Eastern Mediterranean",
  "China": "Western Pacific"
};

// Fetch COVID-19 data
fetch("https://disease.sh/v3/covid-19/countries")
  .then(res => res.json())
  .then(data => {
    data.forEach(country => {
      const region = countryRegionMap[country.country] || "Other";
      const color = regionColors[region];

      // Scale circle radius
      const radius = Math.sqrt(country.cases) / 100; 

      L.circleMarker([country.countryInfo.lat, country.countryInfo.long], {
        radius: radius,
        fillColor: color,
        color: "#555",
        weight: 1,
        opacity: 1,
        fillOpacity: 0.7
      }).addTo(map)
        .bindPopup(`<b>${country.country}</b><br>Cases: ${country.cases.toLocaleString()}<br>Region: ${region}`);
    });
  });

// Add legend
const legend = L.control({position: 'bottomright'});
legend.onAdd = function (map) {
  const div = L.DomUtil.create('div', 'legend');
  div.innerHTML += "<strong>WHO Regions</strong><br>";
  for (let region in regionColors) {
    div.innerHTML += `<i style="background:${regionColors[region]}"></i>${region}<br>`;
  }
  return div;
};
legend.addTo(map);
</script>
</body>
</html>
