<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>COVID-19 WHO-Style Map - Live Covid-19 data</title>
  
  <!-- SEO Meta -->
<meta name="description" content="Interactive COVID-19 dashboard using Python and WHO data. Explore global trends and insights through visual data storytelling." />
<meta name="keywords" content="COVID-19 dashboard, Up to date covid-19 data, Covid-19 Cases today, data visualization, global health, Python, WHO data, Esiah Kapinga, analytics" />
<meta name="author" content="Esiah Kapinga" />
<meta name="robots" content="index, follow" />
<meta name="theme-color" content="#facc15" />
<link rel="canonical" href="https://esiiah.github.io/portfolio-site/live-covid-19.html" />

<!-- Favicon -->
<link rel="icon" type="image/png" href="images/esiah-logo.png" />

<!-- Open Graph & Twitter -->
<meta property="og:title" content="COVID-19 Up-To-Date Data — Esiah Kapinga" />
<meta property="og:description" content="Track global COVID-19 trends using WHO data using disease-sh APIs and Python and HTTPS. Visualized for clarity and insight." />
<meta property="og:image" content="images/your-project-banner.png" />
<meta property="og:url" content="https://esiiah.github.io/portfolio-site/covid-dashboard.html" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="COVID-19 Global Dashboard — Esiah Kapinga" />
<meta name="twitter:description" content="Data visualization of COVID-19 trends worldwide using Python,HTTPS, and WHO data through disease-sh API." />
<meta name="twitter:image" content="images/your-project-banner.png" />

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Poppins:wght@600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
<style>
/* Root & Fonts */
body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background: #ffffff;
    color: #111;
}

/* Reset for header area */
header {
  background-color: white;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  padding: 1rem;
  position: sticky;
  top: 0;
  z-index: 50;
}

header .container {
  max-width: 96rem; /* similar to max-w-6xl */
  margin: 0 auto;
  display: flex;
  align-items: center;
  justify-content: space-between;
  overflow-x: auto;
}

header .logo {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex-shrink: 0;
  text-decoration: none;
  color: black;
}

header .logo img {
  height: 2rem;
  width: auto;
}

header .logo h1 {
  font-size: 1.25rem;
  font-weight: 600;
  letter-spacing: 0.05em;
}

header nav {
  display: flex;
  gap: 0.75rem;
  overflow-x: auto;
  margin-left: 1rem;
  scrollbar-width: none; /* Firefox */
}

header nav::-webkit-scrollbar {
  display: none; /* Chrome/Safari */
}

header nav a {
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
  font-weight: 600;
  text-decoration: none;
  border-radius: 0.5rem;
  white-space: nowrap;
  transition: background-color 0.2s ease;
}

header .btn-yellow-light {
  background-color: #fef9c3;
  color: #ca8a04;
  border: 1px solid #facc15;
}
header .btn-yellow-light:hover {
  background-color: #fef08a;
}

header .btn-yellow-solid {
  background-color: #eab308;
  color: white;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}
header .btn-yellow-solid:hover {
  background-color: #ca8a04;
}


/* ---------- Hero Section Styles ---------- */

/* Common Hero Text */
.hero-text {
    position: absolute;
    top: 0;
    left: 0;
    color: white;
    padding: 1rem;
    border-radius: 0.75rem;
    background: linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(0,0,0,0));
}

/* Hero Text Typography */
.hero-text h1 {
    font-family: 'Poppins', sans-serif;
    font-weight: 700;
    margin-bottom: 0.25rem;
}
.hero-text h2 {
    font-family: 'Poppins', sans-serif;
    font-weight: 700;
    color: #FBBF24;
    margin-bottom: 0.5rem;
}
.hero-text p {
    font-size: 0.875rem;
}

/* ---------- Desktop Hero ---------- */
#hero-desktop {
    width: 100%;
    padding: 0.5rem 0;
    position: relative;
    border-radius: 3rem;
    overflow: hidden;
}

#hero-desktop img {
    width: 100%;
    height: auto;
    display: block;
    border-radius: 3rem;
}

/* Gradient overlay behind text (optional extra layer) */
#hero-desktop::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(0,0,0,0));
    border-radius: 3rem;
    z-index: 1;
}

/* ---------- Mobile Hero ---------- */
#hero-mobile {
    width: 100%;
    padding: 1.5rem 1rem;
    position: relative;
    border-radius: 1.5rem;
    overflow: hidden;
}

#hero-mobile img {
    width: 100%;
    height: auto;
    display: block;
    border-radius: 1.5rem;
}

/* ---------- Visibility Control ---------- */
.desktop-banner {
    display: none;
}

.mobile-banner {
    display: block;
}

/* Show desktop only on screens >=768px, hide mobile */
@media screen and (min-width: 768px) {
    .desktop-banner {
        display: block;
    }
    .mobile-banner {
        display: none;
    }
}


/* Main Content */
main {
    padding: 2rem 4rem;
    max-width: 1200px;
    margin: auto;
}


/* Make sections full width on mobile but keep rounded cards */
@media (max-width: 768px) {
    section {
        width: 100%;
        max-width: none;
        margin-left: 0;
        margin-right: 0;
        border-radius: 0; /* section goes full width */
        padding: 0; /* remove outer padding */
        box-shadow: none;
    }
    section .section-card {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 0 15px rgba(0,0,0,0.1);
        margin: 1rem;
    }
}

/* Tables */
table { border-collapse: collapse; width: 100%; }
th, td { padding: 0.5rem; border: 1px solid #D1D5DB; text-align: left; }
thead { background: #F3F4F6; }

/* Footer */
footer {
    text-align: center;
    color: #6B7280;
    padding: 2rem 1rem;
    border-top: 1px solid #374151;
}
footer a { color: #2563EB; text-decoration: underline; }
footer .social-icons { display: flex; justify-content: center; gap: 1rem; margin-top: 1rem; }
footer .social-icons img { width: 1.5rem; height: 1.5rem; }

/* Map & Info Panel */
#map {
    height: 600px;
    width: 100%;
    border-radius: 8px;
}
.info-panel {
    margin-top: 20px;
    padding: 15px;
    background: #fafafa;
    border-radius: 8px;
}
select {
    padding: 5px;
    margin-bottom: 10px;
    font-size: 14px;
}
.legend {
    list-style: none;
    padding-left: 0;
}
.legend li {
    display: flex;
    align-items: center;
    margin: 4px 0;
}
.legend i {
    width: 14px;
    height: 14px;
    display: inline-block;
    margin-right: 8px;
    border-radius: 3px;
}

/* Animations */
@keyframes spin-slow { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);} }
@keyframes fadeInOut { 0%,100%{opacity:0;} 50%{opacity:1;} }
@keyframes slide { 0% {transform: translateX(0);} 20% {transform: translateX(-100%);} 40% {transform: translateX(-200%);} 60% {transform: translateX(-300%);} 80% {transform: translateX(-400%);} 100% {transform: translateX(-500%);} }

/* Responsive */
@media (min-width: 768px) {
    #hero-desktop { display: block; }
    #hero-mobile { display: none; }
}

/* Mobile adjustments */
@media (max-width: 767px) {
    main {
        padding: 1rem;  /* smaller padding on phone */
    }
    section {
        padding: 15px;  /* reduce section padding for better fit */
    }
    section h2 {
        font-size: 1.25rem; /* smaller heading */
    }
    section ul li, section ol li {
        font-size: 0.9rem; /* smaller list items */
    }
    .hero-text h1 {
        font-size: 1rem;
    }
    .hero-text h2 {
        font-size: 0.875rem;
    }
    .hero-text p {
        font-size: 0.75rem;
    }
    #map {
        height: 400px; /* smaller map for mobile */
    }
}
</style>
</head>

<body style="margin:0; padding:0; background-color:white; font-family:sans-serif; color:black;">
<header>
  <div class="container">
    <!-- Logo and Name -->
    <a href="index.html" class="logo">
      <img src="images/esiah-logo.png" alt="Esiah Logo" />
      <h1>Esiah</h1>
    </a>

    <!-- Navigation -->
    <nav>
      <a href="index.html#home" class="btn-yellow-light">Home</a>
      <a href="index.html#projects" class="btn-yellow-solid">Projects</a>
      <a href="Esiah-Kapinga-Resume.pdf" download class="btn-yellow-light">Resume</a>
      <a href="index.html#contact" class="btn-yellow-light">Contact</a>
    </nav>
  </div>
</header>

<!-- Desktop COVID Banner -->
<section class="desktop-banner" style="width: 100%; background: #fff; padding: 0.5rem 2rem;">
    <div style="position: relative; border-radius: 3rem; overflow: hidden; max-width: 2069.856px; margin: 0 auto;">
        <img src="images/covid-banner.png"
             alt="COVID Analysis Banner"
             style="width: 100%; height: 500px; object-fit: cover; display: block;" />

        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: flex-start; padding: 2rem;">
            <div style="background: linear-gradient(to bottom, rgba(0,0,0,0.7), rgba(0,0,0,0)); padding: 1.5rem; max-width: 600px; color: white;">
                <h1 style="font-family: 'Poppins', sans-serif; font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">
                    COVID-19 Data Insights
                </h1>
                <h2 style="font-family: 'Poppins', sans-serif; font-size: 1.75rem; font-weight: 700; color: #FBBF24; margin-bottom: 0.5rem; text-shadow: 0 1px 3px rgba(0,0,0,0.5);">
                    Regional & Global Trends
                </h2>
                <p style="font-size: 1rem; text-shadow: 0 1px 2px rgba(0,0,0,0.5);">
                    Analysis of COVID-19 cases, vaccinations, and mortality rates across regions.
                </p>
            </div>
        </div>
    </div>
</section>

<!-- Mobile COVID Banner -->
<section class="mobile-banner" style="width: 100%; background: #fff; padding: 1.5rem 1rem;">
    <div style="position: relative; border-radius: 1.5rem; overflow: hidden;">
        <img src="images/covid-mb-banner.png"
             alt="COVID Analysis Banner"
             style="width: 100%; height: auto; object-fit: cover; border-radius: 1.5rem; display: block;" />

        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: flex-start; justify-content: flex-start; padding: 1rem;">
            <div style="background: linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(0,0,0,0)); padding: 1rem; border-radius: 0.75rem; max-width: 90%;">
                <h1 style="font-family: 'Poppins', sans-serif; font-size: 1.25rem; font-weight: 700; margin-bottom: 0.25rem; color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.5);">
                    COVID-19 Data Insights
                </h1>
                <h2 style="font-family: 'Poppins', sans-serif; font-size: 1rem; font-weight: 700; color: #FBBF24; margin-bottom: 0.5rem; text-shadow: 0 1px 2px rgba(0,0,0,0.5);">
                    Regional & Global Trends
                </h2>
                <p style="font-size: 0.875rem; color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.5);">
                    Analysis of COVID-19 cases, vaccinations, and mortality rates across regions.
                </p>
            </div>
        </div>
    </div>
</section>

  
<!-- Main Content -->
<main style="padding: 1rem 4%; max-width: 100%;">
<!-- Overview -->
<section>
     <h2>Overview</h2>
     <p>This project leverages real-time COVID-19 data fetched from the <a href="https://disease.sh" target="_blank">disease.sh API</a> to visualize global trends, including infection rates, recovery trajectories, and geographical impact. Using JavaScript, Leaflet.js, and GeoJSON, the project builds an interactive dashboard and live maps, providing up-to-date epidemiological insights.</p>

     <!-- Objectives -->
     <h2>Objectives</h2>
        <ul>
          <li>Fetch real-time COVID-19 data globally via the disease.sh API</li>
          <li>Build an interactive world map showing live infection hotspots and recovery distribution</li>
          <li>Plot live daily trends for confirmed cases, deaths, and recoveries by country/region</li>
          <li>Enable user filtering by date range and country to see dynamic data changes</li>
          <li>Provide insights into pandemic progression and regional differences using live data</li>
         </ul>
</section>

<section>
  <h2>COVID-19 Cases by Country (WHO Style)</h2>
  
  <label for="range">Select Time Range:</label>
  <select id="range">
    <option value="7">Last 7 Days</option>
    <option value="30">Last 30 Days</option>
    <option value="365">Last 365 Days</option>
    <option value="all">All Time</option>
  </select>

  <div id="map"></div>

  <div class="info-panel">
    <h3>WHO Region Color Codes</h3>
    <p>This map shows reported COVID-19 cases by selected date range, using WHO regional colors:</p>
    <ul class="legend">
      <li><i style="background:#7b4bc2"></i> Africa</li>
      <li><i style="background:#ff7f0e"></i> Americas</li>
      <li><i style="background:#d62728"></i> Eastern Mediterranean</li>
      <li><i style="background:#1f77b4"></i> Europe</li>
      <li><i style="background:#2ca02c"></i> South-East Asia</li>
      <li><i style="background:#bcbd22"></i> Western Pacific</li>
    </ul>
  </div>
  
<!-- Country Search & Stats Subsection -->
<div class="country-stats" style="margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 8px;">
    <h3>Search Country Data</h3>
    
    <label for="countrySelect">Select Country:</label>
    <select id="countrySelect">
        <option value="">--Choose a Country--</option>
        <!-- Country options will be populated dynamically -->
    </select>

    <label for="countryRange" style="margin-left: 10px;">Select Time Range:</label>
    <select id="countryRange">
        <option value="7">Last 7 Days</option>
        <option value="30">Last 30 Days</option>
        <option value="365">Last 365 Days</option>
        <option value="all">All Time</option>
    </select>

    <div id="countryInfo" style="margin-top: 15px; font-size: 0.95rem; color: #111;">
        <p><strong>Cases:</strong> <span id="casesCount">—</span></p>
        <p><strong>Deaths:</strong> <span id="deathsCount">—</span></p>
        <p><strong>Recovered:</strong> <span id="recoveredCount">—</span></p>
    </div>
</div>
</section>

<!-- Trend Charts Section -->
<section id="trend-section" style="margin-top: 40px;">
    <h2>COVID-19 Trends</h2>
    <p>Showing daily trends for the selected country and time range.</p>

    <div style="display: flex; flex-wrap: wrap; gap: 20px;">
        <div style="flex: 1; min-width: 350px;">
            <canvas id="casesChart"></canvas>
        </div>
        <div style="flex: 1; min-width: 350px;">
            <canvas id="deathsChart"></canvas>
        </div>
    </div>
</section>

    <!-- Data Sources -->
    <section>
        <h2>Data Sources</h2>
        <table>
            <thead>
                <tr><th>Source</th><th>Description</th></tr>
            </thead>
            <tbody>
                <tr><td>WHO API</td><td>Official COVID-19 data</td></tr>
                <tr><td>Country GeoJSON</td><td>Country shapes for maps</td></tr>
                <tr><td>World Bank (optional)</td><td>Demographic overlays (population)</td></tr>
            </tbody>
        </table>
        <p style="margin-top:0.5rem;font-size:0.875rem;font-style:italic;">
            WHO COVID-19 Data Endpoint: <br>
            <a href="https://covid19.who.int/page-data/table/page-data.json" target="_blank">https://covid19.who.int/page-data/table/page-data.json</a>
        </p>

    <!-- Methods & Tools -->
        <h2>Methods & Tools</h2>
        <ol>
            <li><strong>Data Retrieval</strong>: Accessed WHO or COVID19 API, parsed JSON into Pandas, cleaned missing/inconsistent values.</li>
            <li><strong>Data Wrangling</strong>: Aggregated case data, calculated rates, merged with GeoJSON country coordinates.</li>
            <li><strong>Mapping (Folium)</strong>: Built choropleth maps and circle marker layers with popups.</li>
            <li><strong>Visualization (Plotly)</strong>: Created interactive time series plots, bar charts, and optional animations.</li>
        </ol>

    <!-- Example Insights -->
        <h2>Example Insights</h2>
        <ul>
            <li>India, USA, and Brazil exhibited consistent surges aligned with policy delays.</li>
            <li>Recovery rates rose significantly post-July 2021 with mass vaccination campaigns.</li>
            <li>African nations showed underreporting patterns — visualized as data sparsity.</li>
            <li>Reinfection waves (Delta, Omicron) visualized in animated strain-period plots.</li>
        </ul>

      <!-- Tools Used for Interactive Live Data Map -->
        <h2>Tools Used for Interactive Live Data Map</h2>
        <table>
            <thead>
                <tr><th>Tool</th><th>Purpose</th></tr>
            </thead>
            <tbody>
                <tr><td>JavaScript</td><td>Fetch live API data and build interactive visualizations</td></tr>
                <tr><td>Leaflet.js</td><td>Interactive maps with markers, popups, and layers</td></tr>
                <tr><td>disease.sh API</td><td>Real-time global COVID-19 data</td></tr>
                <tr><td>GeoJSON</td><td>Country coordinates and shapes for mapping</td></tr>
                <tr><td>HTML & CSS</td><td>Page structure, styling, and responsive layout</td></tr>
                <tr><td>Optional Libraries (Chart.js / Plotly)</td><td>Interactive charts linked with map data</td></tr>
            </tbody>
        </table>

    <!-- Tools We can use for Static Map-->
        <h2>Tools We can use for Static Map</h2>
        <table>
            <thead>
                <tr><th>Tool</th><th>Purpose</th></tr>
            </thead>
            <tbody>
                <tr><td>Python</td><td>Data processing and visualization</td></tr>
                <tr><td>Pandas</td><td>Data cleaning and manipulation</td></tr>
                <tr><td>Plotly</td><td>Interactive graphs and plots</td></tr>
                <tr><td>Folium</td><td>Geospatial mapping</td></tr>
                <tr><td>GeoJSON</td><td>Geolocation mapping</td></tr>
                <tr><td>Jupyter Notebook</td><td>Interactive development</td></tr>
            </tbody>
        </table>

    <!-- Applications -->
        <h2>Applications</h2>
        <ul>
            <li>Public health communication to display global pandemic impact</li>
            <li>Support for policy decision-making and resource allocation</li>
            <li>Educational tool for understanding epidemiological data</li>
            <li>Research support in real-time COVID surveillance and modeling</li>
        </ul>
    </section>
</main>
  
<!-- Footer -->
<footer>
    <p>All visualizations and maps are interactive. Data is updated regularly. Ethical considerations were applied regarding reporting accuracy and transparency.</p>
    <div class="social-icons">
        <a href="https://www.linkedin.com/in/esiah-kapinga" target="_blank"><img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/linkedin/linkedin-original.svg" alt="LinkedIn"></a>
        <a href="https://github.com/esiiah" target="_blank"><img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/github/github-original.svg" alt="GitHub"></a>
        <a href="https://www.instagram.com/esiah_kapinga" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" alt="Instagram"></a>
        <a href="https://youtube.com/esiah.1" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/1384/1384060.png" alt="YouTube"></a>
    </div>
    <p style="margin-top:0.5rem;">&copy; 2025 Esiah Kapinga - COVID-19 Live Data Project</p>
</footer>
  
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ========================
// MAP INITIALIZATION
// ========================
const map = L.map('map', {
    worldCopyJump: true, // prevents multiple map tiles when panning horizontally
    maxBounds: [[-90, -180], [90, 180]]
}).setView([20, 0], 2);

map.setMaxBounds([[-90, -180], [90, 180]]);
map.setMinZoom(2);
map.setMaxZoom(6);

L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; OpenStreetMap contributors &copy; CARTO',
    subdomains: 'abcd',
    maxZoom: 19
}).addTo(map);

// ========================
// REGION COLORS & MAPPING
// ========================
const regionColors = {
    "Africa": "#7b4bc2",
    "Americas": "#ff7f0e",
    "Eastern Mediterranean": "#d62728",
    "Europe": "#1f77b4",
    "South-East Asia": "#2ca02c",
    "Western Pacific": "#bcbd22",
    "Other": "#999"
};

const countryRegionMap = {
    "Algeria": "Africa", "Nigeria": "Africa", "South Africa": "Africa", "Kenya": "Africa", "Ethiopia": "Africa", "Egypt": "Eastern Mediterranean",
    "United States": "Americas", "Brazil": "Americas", "Canada": "Americas", "Mexico": "Americas", "Argentina": "Americas", "Chile": "Americas",
    "Pakistan": "Eastern Mediterranean", "Iran": "Eastern Mediterranean", "Afghanistan": "Eastern Mediterranean", "Saudi Arabia": "Eastern Mediterranean",
    "France": "Europe", "Germany": "Europe", "Italy": "Europe", "Spain": "Europe", "United Kingdom": "Europe", "Russia": "Europe", "Ukraine": "Europe",
    "India": "South-East Asia", "Indonesia": "South-East Asia", "Thailand": "South-East Asia", "Bangladesh": "South-East Asia", "Nepal": "South-East Asia",
    "China": "Western Pacific", "Japan": "Western Pacific", "Australia": "Western Pacific", "Philippines": "Western Pacific", "Vietnam": "Western Pacific", "New Zealand": "Western Pacific"
};

let markers = [];

// ========================
// LOAD MAP DATA
// ========================
async function loadData(days) {
    markers.forEach(m => map.removeLayer(m));
    markers = [];

    const countriesRes = await fetch("https://disease.sh/v3/covid-19/countries");
    const countries = await countriesRes.json();

    const countryData = [];
    for (let c of countries) {
        const histRes = await fetch(`https://disease.sh/v3/covid-19/historical/${encodeURIComponent(c.country)}?lastdays=${days === 'all' ? 1000 : days}`);
        const hist = await histRes.json();

        if (!hist.timeline || !hist.timeline.cases) continue;

        const casesTimeline = Object.values(hist.timeline.cases);
        let casesCount = 0;
        for (let i = 1; i < casesTimeline.length; i++) {
            casesCount += casesTimeline[i] - casesTimeline[i - 1];
        }

        countryData.push({
            country: c.country,
            lat: c.countryInfo.lat,
            long: c.countryInfo.long,
            cases: casesCount
        });
    }

    const maxCases = Math.max(...countryData.map(d => d.cases));
    const maxRadius = 40;

    countryData.forEach(c => {
        const region = countryRegionMap[c.country] || "Other";
        const color = regionColors[region];
        const radius = Math.sqrt(c.cases / maxCases) * maxRadius;

        const circle = L.circleMarker([c.lat, c.long], {
            radius: radius,
            fillColor: color,
            color: "#555",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.7
        }).bindPopup(
            `<b>${c.country}</b><br>Cases in range: ${c.cases.toLocaleString()}<br>Region: ${region}`
        );

        circle.on("mouseover", function () { this.openPopup(); });
        circle.on("mouseout", function () { this.closePopup(); });

        markers.push(circle);
        circle.addTo(map);
    });
}

loadData(7);

document.getElementById("range").addEventListener("change", (e) => {
    loadData(e.target.value);
});

// ========================
// COUNTRY SELECT OPTIONS
// ========================
const countrySelect = document.getElementById('countrySelect');

async function loadCountryOptions() {
    const res = await fetch('https://disease.sh/v3/covid-19/countries');
    const countries = await res.json();
    countries.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c.country;
        opt.textContent = c.country;
        countrySelect.appendChild(opt);
    });
}
loadCountryOptions();

// ========================
// COUNTRY DATA DISPLAY
// ========================
async function loadCountryData(country, days) {
    if (!country) return;
    const res = await fetch(`https://disease.sh/v3/covid-19/historical/${country}?lastdays=${days === 'all' ? 1000 : days}`);
    const data = await res.json();
    if (!data.timeline) return;

    const casesTimeline = Object.values(data.timeline.cases);
    const deathsTimeline = Object.values(data.timeline.deaths);
    const recoveredTimeline = Object.values(data.timeline.recovered);

    const casesCount = days === 'all' ? casesTimeline[casesTimeline.length - 1] : casesTimeline[casesTimeline.length - 1] - casesTimeline[0];
    const deathsCount = days === 'all' ? deathsTimeline[deathsTimeline.length - 1] : deathsTimeline[deathsTimeline.length - 1] - deathsTimeline[0];
    const recoveredCount = days === 'all' ? recoveredTimeline[recoveredTimeline.length - 1] : recoveredTimeline[recoveredTimeline.length - 1] - recoveredTimeline[0];

    document.getElementById('casesCount').textContent = casesCount.toLocaleString();
    document.getElementById('deathsCount').textContent = deathsCount.toLocaleString();
    document.getElementById('recoveredCount').textContent = recoveredCount.toLocaleString();
}

countrySelect.addEventListener('change', () => {
    const country = countrySelect.value;
    const days = document.getElementById('countryRange').value;
    loadCountryData(country, days);
    updateTrendCharts(country, days);
});

document.getElementById('countryRange').addEventListener('change', () => {
    const country = countrySelect.value;
    const days = document.getElementById('countryRange').value;
    loadCountryData(country, days);
    updateTrendCharts(country, days);
});

// ========================
// TREND CHARTS
// ========================
let casesChartInstance;
let deathsChartInstance;

function createOrUpdateChart(chartInstance, ctx, label, labels, data, borderColor) {
    if (chartInstance) {
        chartInstance.data.labels = labels;
        chartInstance.data.datasets[0].data = data;
        chartInstance.update();
        return chartInstance;
    }
    return new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: label,
                data: data,
                borderColor: borderColor,
                backgroundColor: borderColor + '33',
                fill: true,
                tension: 0.3,
                pointRadius: 0
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: true }
            },
            scales: {
                x: { display: true },
                y: { display: true }
            }
        }
    });
}

async function updateTrendCharts(country, days) {
    if (!country) return;
    const res = await fetch(`https://disease.sh/v3/covid-19/historical/${country}?lastdays=${days === 'all' ? 1000 : days}`);
    const data = await res.json();
    if (!data.timeline) return;

    const labels = Object.keys(data.timeline.cases);
    const casesData = Object.values(data.timeline.cases);
    const deathsData = Object.values(data.timeline.deaths);

    const ctxCases = document.getElementById('casesChart').getContext('2d');
    const ctxDeaths = document.getElementById('deathsChart').getContext('2d');

    casesChartInstance = createOrUpdateChart(casesChartInstance, ctxCases, 'Cases', labels, casesData, '#007bff');
    deathsChartInstance = createOrUpdateChart(deathsChartInstance, ctxDeaths, 'Deaths', labels, deathsData, '#ff0000');
}
</script>
</body>
</html>
